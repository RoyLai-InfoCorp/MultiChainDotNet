trigger:
    - main

pool:
    vmImage: ubuntu-latest

variables:
    solution: '$(Build.SourcesDirectory)\MultiChainDotNet.sln'
    buildPlatform: 'Any CPU'
    buildConfiguration: 'Release'

steps:
    - task: DotNetCoreCLI@2
      displayName: Update NBGV tool
      inputs:
          command: custom
          custom: tool
          arguments: install --tool-path . nbgv

    - script: nbgv cloud -c -a
      displayName: Set Version

    - task: NuGetCommand@2
      inputs:
          restoreSolution: '$(solution)'
      displayName: Restore packages

    - task: DotNetCoreCLI@2
      inputs:
          command: 'build'
          arguments: '--configuration $(buildConfiguration)'
          projects: '$(Build.SourcesDirectory)/src/MultiChainDotNet.Core/MultiChainDotNet.Core.csproj'
      displayName: Build

    - task: PublishPipelineArtifact@1
      inputs:
        targetPath: '$(Pipeline.Workspace)'
        artifactType: 'pipeline'
        artifactName: 'drop'

    # - task: DotNetCoreCLI@2
    #   inputs:
    #       command: 'pack'
    #       arguments: '--configuration $(buildConfiguration)'
    #       packDirectory: '$(System.ArtifactsDirectory)/packages'
    #       projects: '$(Build.SourcesDirectory)/src/MultiChainDotNet.Core/MultiChainDotNet.Core.csproj'
    #   displayName: Build and pack

    # - task: DotNetCoreCLI@2
    #   inputs:
    #     command: 'push'
    #     packagesToPush: '$(System.ArtifactsDirectory)/packages/**/*.nupkg'
    #     nugetFeedType: 'external'
    #     externalEndPoint: 'nuget-service-connection'


    # - task: NuGetCommand@2
    #   displayName: 'NuGet push'
    #   inputs:
    #       command: push
    #       feedsToUse: 'nuget-service-connection'
    #       packagesToPush: '$(System.ArtifactsDirectory)/**/*.nupkg'
    #       allowPackageConflicts: false
    #       includeNugetOrg: 'true'

